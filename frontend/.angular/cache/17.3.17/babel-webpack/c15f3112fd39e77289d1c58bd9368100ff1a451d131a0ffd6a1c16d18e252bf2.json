{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { RouterModule } from '@angular/router';\nimport { Validators, ReactiveFormsModule } from '@angular/forms';\nlet PatientDashboardComponent = class PatientDashboardComponent {\n  constructor(router, fb, authService, appointmentService, userService) {\n    this.router = router;\n    this.fb = fb;\n    this.authService = authService;\n    this.appointmentService = appointmentService;\n    this.userService = userService;\n    this.currentUser = null;\n    this.appointments = [];\n    this.therapists = [];\n    this.doctorsList = [];\n    this.availableSlots = [];\n    this.showBookingForm = false;\n    this.minDate = '';\n    this.bookingForm = this.fb.group({\n      specialty: ['', Validators.required],\n      doctorId: ['', Validators.required],\n      date: ['', Validators.required],\n      time: ['', Validators.required],\n      reason: ['']\n    });\n    const today = new Date();\n    this.minDate = today.toISOString().split('T')[0];\n  }\n  ngOnInit() {\n    this.currentUser = this.authService.getCurrentUser();\n    this.loadAppointments();\n    this.loadTherapists();\n  }\n  loadAppointments() {\n    this.appointmentService.getAppointments().subscribe({\n      next: data => {\n        this.appointments = data;\n      }\n    });\n  }\n  loadTherapists() {\n    this.userService.getDoctors('therapist').subscribe({\n      next: data => {\n        this.therapists = data;\n      }\n    });\n  }\n  assignFamilyDoctor(doctorId) {\n    this.userService.assignFamilyDoctor(doctorId).subscribe({\n      next: data => {\n        this.currentUser = data;\n        this.authService.currentUser$.subscribe(user => {\n          if (user) {\n            user.familyDoctor = data.familyDoctor;\n          }\n        });\n      }\n    });\n  }\n  onSpecialtyChange() {\n    const specialty = this.bookingForm.get('specialty')?.value;\n    if (specialty) {\n      this.userService.getDoctors(specialty).subscribe({\n        next: data => {\n          this.doctorsList = data;\n        }\n      });\n    }\n  }\n  onDoctorChange() {\n    this.bookingForm.patchValue({\n      date: '',\n      time: ''\n    });\n    this.availableSlots = [];\n  }\n  onDateChange() {\n    const doctorId = this.bookingForm.get('doctorId')?.value;\n    const date = this.bookingForm.get('date')?.value;\n    if (doctorId && date) {\n      this.appointmentService.getAvailableSlots(doctorId, date).subscribe({\n        next: data => {\n          this.availableSlots = data;\n        }\n      });\n    }\n  }\n  selectTime(time) {\n    this.bookingForm.patchValue({\n      time\n    });\n    const slots = document.querySelectorAll('.time-slot');\n    slots.forEach(slot => slot.classList.remove('selected'));\n    event?.target && event.target.classList.add('selected');\n  }\n  onBookingSubmit() {\n    if (this.bookingForm.valid) {\n      const formData = this.bookingForm.value;\n      this.appointmentService.createAppointment(formData).subscribe({\n        next: () => {\n          this.loadAppointments();\n          this.bookingForm.reset();\n          this.showBookingForm = false;\n          this.availableSlots = [];\n        }\n      });\n    }\n  }\n  cancelAppointment(id) {\n    if (confirm('Вы уверены, что хотите отменить запись?')) {\n      this.appointmentService.cancelAppointment(id).subscribe({\n        next: () => {\n          this.loadAppointments();\n        }\n      });\n    }\n  }\n  getSpecialtyName(specialty) {\n    const specialties = {\n      therapist: 'Терапевт',\n      surgeon: 'Хирург',\n      cardiologist: 'Кардиолог',\n      neurologist: 'Невролог',\n      dermatologist: 'Дерматолог',\n      pediatrician: 'Педиатр',\n      ophthalmologist: 'Офтальмолог',\n      psychiatrist: 'Психиатр'\n    };\n    return specialty ? specialties[specialty] : '';\n  }\n  getStatusName(status) {\n    const statuses = {\n      scheduled: 'Запланировано',\n      completed: 'Завершено',\n      cancelled: 'Отменено'\n    };\n    return statuses[status] || status;\n  }\n  formatDate(date) {\n    return new Date(date).toLocaleDateString('ru-RU');\n  }\n  logout() {\n    this.authService.logout();\n    this.router.navigate(['/login']);\n  }\n};\nPatientDashboardComponent = __decorate([Component({\n  selector: 'app-patient-dashboard',\n  standalone: true,\n  imports: [CommonModule, RouterModule, ReactiveFormsModule],\n  template: `\n        <div class=\"dashboard\">\n            <header class=\"header\">\n                <div class=\"header-content\">\n                    <h1>Личный кабинет пациента</h1>\n                    <div class=\"user-info\">\n                        <span>{{ currentUser?.firstName }} {{ currentUser?.lastName }}</span>\n                        <button (click)=\"logout()\" class=\"btn-logout\">Выход</button>\n                    </div>\n                </div>\n            </header>\n\n            <div class=\"content\">\n                <div class=\"sidebar\">\n                    <nav>\n                        <a routerLink=\"/patient\" routerLinkActive=\"active\" [routerLinkActiveOptions]=\"{exact: true}\">\n                            Мои приемы\n                        </a>\n                        <a routerLink=\"/patient/doctors\" routerLinkActive=\"active\">\n                            Записаться на прием\n                        </a>\n                        <a routerLink=\"/patient/medical-records\" routerLinkActive=\"active\">\n                            Медицинская карта\n                        </a>\n                        <a routerLink=\"/patient/profile\" routerLinkActive=\"active\">\n                            Профиль\n                        </a>\n                    </nav>\n                </div>\n\n                <main class=\"main-content\">\n                    <div class=\"family-doctor-section\" *ngIf=\"!currentUser?.familyDoctor\">\n                        <h2>Семейный врач</h2>\n                        <p>У вас нет семейного врача. Выберите терапевта:</p>\n\n                        <div class=\"doctors-grid\" *ngIf=\"therapists.length > 0\">\n                            <div class=\"doctor-card\" *ngFor=\"let doctor of therapists\">\n                                <h3>{{ doctor.firstName }} {{ doctor.lastName }}</h3>\n                                <p>{{ doctor.email }}</p>\n                                <p>{{ doctor.phone }}</p>\n                                <button class=\"btn-primary\" (click)=\"assignFamilyDoctor(doctor.id)\">\n                                    Выбрать\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class=\"family-doctor-info\" *ngIf=\"currentUser?.familyDoctor\">\n                        <h2>Семейный врач</h2>\n                        <div class=\"doctor-info\">\n                            <h3>{{ currentUser?.familyDoctor?.firstName }} {{ currentUser?.familyDoctor?.lastName }}</h3>\n                            <p>{{ currentUser?.familyDoctor?.email }}</p>\n                            <p>{{ currentUser?.familyDoctor?.phone }}</p>\n                        </div>\n                    </div>\n\n                    <div class=\"appointments-section\">\n                        <h2>Мои записи на прием</h2>\n\n                        <div class=\"appointments-list\" *ngIf=\"appointments.length > 0; else noAppointments\">\n                            <div class=\"appointment-card\" *ngFor=\"let appointment of appointments\">\n                                <div class=\"appointment-header\">\n                                    <div>\n                                        <h3>{{ appointment.doctor.firstName }} {{ appointment.doctor.lastName }}</h3>\n                                        <p class=\"specialty\">{{ getSpecialtyName(appointment.doctor.specialty) }}</p>\n                                    </div>\n                                    <span class=\"status\"\n                                          [class]=\"appointment.status\">{{ getStatusName(appointment.status) }}</span>\n                                </div>\n                                <div class=\"appointment-details\">\n                                    <div class=\"detail\">\n                                        <strong>Дата:</strong> {{ formatDate(appointment.date) }}\n                                    </div>\n                                    <div class=\"detail\">\n                                        <strong>Время:</strong> {{ appointment.time }}\n                                    </div>\n                                    <div class=\"detail\">\n                                        <strong>Причина:</strong> {{ appointment.reason || 'Не указана' }}\n                                    </div>\n                                </div>\n                                <div class=\"appointment-actions\" *ngIf=\"appointment.status === 'scheduled'\">\n                                    <button class=\"btn-cancel\" (click)=\"cancelAppointment(appointment._id)\">\n                                        Отменить\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n\n                        <ng-template #noAppointments>\n                            <p class=\"no-data\">У вас нет записей на прием</p>\n                        </ng-template>\n                    </div>\n\n                    <div class=\"booking-section\" *ngIf=\"showBookingForm\">\n                        <h2>Записаться на прием</h2>\n\n                        <form [formGroup]=\"bookingForm\" (ngSubmit)=\"onBookingSubmit()\">\n                            <div class=\"form-group\">\n                                <label>Специализация</label>\n                                <select formControlName=\"specialty\" class=\"form-control\" (change)=\"onSpecialtyChange()\">\n                                    <option value=\"\">Выберите специализацию</option>\n                                    <option value=\"therapist\">Терапевт</option>\n                                    <option value=\"surgeon\">Хирург</option>\n                                    <option value=\"cardiologist\">Кардиолог</option>\n                                    <option value=\"neurologist\">Невролог</option>\n                                    <option value=\"dermatologist\">Дерматолог</option>\n                                    <option value=\"pediatrician\">Педиатр</option>\n                                    <option value=\"ophthalmologist\">Офтальмолог</option>\n                                    <option value=\"psychiatrist\">Психиатр</option>\n                                </select>\n                            </div>\n\n                            <div class=\"form-group\" *ngIf=\"doctorsList.length > 0\">\n                                <label>Врач</label>\n                                <select formControlName=\"doctorId\" class=\"form-control\" (change)=\"onDoctorChange()\">\n                                    <option value=\"\">Выберите врача</option>\n                                    <option *ngFor=\"let doctor of doctorsList\" [value]=\"doctor.id\">\n                                        {{ doctor.firstName }} {{ doctor.lastName }}\n                                    </option>\n                                </select>\n                            </div>\n\n                            <div class=\"form-group\" *ngIf=\"bookingForm.get('doctorId')?.value\">\n                                <label>Дата</label>\n                                <input type=\"date\" formControlName=\"date\" class=\"form-control\" (change)=\"onDateChange()\"\n                                       [min]=\"minDate\">\n                            </div>\n\n                            <div class=\"form-group\" *ngIf=\"availableSlots.length > 0\">\n                                <label>Время</label>\n                                <div class=\"time-slots\">\n                                    <button\n                                            type=\"button\"\n                                            class=\"time-slot\"\n                                            *ngFor=\"let slot of availableSlots\"\n                                            [class.disabled]=\"!slot.available\"\n                                            [disabled]=\"!slot.available\"\n                                            (click)=\"selectTime(slot.time)\">\n                                        {{ slot.time }}\n                                    </button>\n                                </div>\n                            </div>\n\n                            <div class=\"form-group\">\n                                <label>Причина обращения</label>\n                                <textarea formControlName=\"reason\" class=\"form-control\" rows=\"3\"></textarea>\n                            </div>\n\n                            <button type=\"submit\" class=\"btn-primary\" [disabled]=\"bookingForm.invalid\">\n                                Записаться\n                            </button>\n                        </form>\n                    </div>\n                </main>\n            </div>\n        </div>\n    `,\n  styles: [`\n        .dashboard {\n            min-height: 100vh;\n            background: #f5f7fa;\n        }\n\n        .header {\n            background: white;\n            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n            padding: 20px 0;\n        }\n\n        .header-content {\n            max-width: 1400px;\n            margin: 0 auto;\n            padding: 0 20px;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n\n        h1 {\n            color: #333;\n            font-size: 28px;\n            margin: 0;\n        }\n\n        .user-info {\n            display: flex;\n            align-items: center;\n            gap: 15px;\n        }\n\n        .btn-logout {\n            padding: 8px 20px;\n            background: #e74c3c;\n            color: white;\n            border: none;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 14px;\n        }\n\n        .content {\n            max-width: 1400px;\n            margin: 30px auto;\n            padding: 0 20px;\n            display: grid;\n            grid-template-columns: 250px 1fr;\n            gap: 30px;\n        }\n\n        .sidebar {\n            background: white;\n            border-radius: 12px;\n            padding: 20px;\n            height: fit-content;\n            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n        }\n\n        .sidebar nav {\n            display: flex;\n            flex-direction: column;\n            gap: 10px;\n        }\n\n        .sidebar a {\n            padding: 12px 16px;\n            color: #555;\n            text-decoration: none;\n            border-radius: 8px;\n            transition: all 0.3s;\n        }\n\n        .sidebar a:hover {\n            background: #f5f7fa;\n        }\n\n        .sidebar a.active {\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n        }\n\n        .main-content {\n            display: flex;\n            flex-direction: column;\n            gap: 30px;\n        }\n\n        .family-doctor-section, .family-doctor-info, .appointments-section, .booking-section {\n            background: white;\n            border-radius: 12px;\n            padding: 30px;\n            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n        }\n\n        h2 {\n            color: #333;\n            font-size: 24px;\n            margin-bottom: 20px;\n        }\n\n        .doctors-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));\n            gap: 20px;\n            margin-top: 20px;\n        }\n\n        .doctor-card {\n            border: 2px solid #e0e0e0;\n            border-radius: 10px;\n            padding: 20px;\n            text-align: center;\n        }\n\n        .doctor-card h3 {\n            color: #333;\n            font-size: 18px;\n            margin: 0 0 10px 0;\n        }\n\n        .doctor-card p {\n            color: #666;\n            font-size: 14px;\n            margin: 5px 0;\n        }\n\n        .doctor-info {\n            border: 2px solid #667eea;\n            border-radius: 10px;\n            padding: 20px;\n        }\n\n        .doctor-info h3 {\n            color: #333;\n            font-size: 20px;\n            margin: 0 0 10px 0;\n        }\n\n        .doctor-info p {\n            color: #666;\n            font-size: 14px;\n            margin: 5px 0;\n        }\n\n        .appointments-list {\n            display: grid;\n            gap: 20px;\n        }\n\n        .appointment-card {\n            border: 2px solid #e0e0e0;\n            border-radius: 10px;\n            padding: 20px;\n        }\n\n        .appointment-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: flex-start;\n            margin-bottom: 15px;\n        }\n\n        .appointment-header h3 {\n            color: #333;\n            font-size: 20px;\n            margin: 0;\n        }\n\n        .specialty {\n            color: #667eea;\n            font-size: 14px;\n            margin: 5px 0 0 0;\n        }\n\n        .status {\n            padding: 6px 14px;\n            border-radius: 20px;\n            font-size: 13px;\n            font-weight: 500;\n        }\n\n        .status.scheduled {\n            background: #e3f2fd;\n            color: #1976d2;\n        }\n\n        .status.completed {\n            background: #e8f5e9;\n            color: #388e3c;\n        }\n\n        .status.cancelled {\n            background: #ffebee;\n            color: #d32f2f;\n        }\n\n        .appointment-details {\n            display: grid;\n            grid-template-columns: repeat(3, 1fr);\n            gap: 10px;\n            margin-bottom: 15px;\n        }\n\n        .detail {\n            color: #666;\n            font-size: 14px;\n        }\n\n        .detail strong {\n            color: #333;\n            margin-right: 5px;\n        }\n\n        .appointment-actions {\n            display: flex;\n            justify-content: flex-end;\n        }\n\n        .btn-cancel {\n            padding: 10px 20px;\n            background: #e74c3c;\n            color: white;\n            border: none;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 14px;\n        }\n\n        .form-group {\n            margin-bottom: 20px;\n        }\n\n        label {\n            display: block;\n            margin-bottom: 8px;\n            color: #555;\n            font-weight: 500;\n        }\n\n        .form-control {\n            width: 100%;\n            padding: 12px;\n            border: 2px solid #e0e0e0;\n            border-radius: 8px;\n            font-size: 15px;\n            transition: border-color 0.3s;\n            box-sizing: border-box;\n        }\n\n        .form-control:focus {\n            outline: none;\n            border-color: #667eea;\n        }\n\n        .time-slots {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));\n            gap: 10px;\n        }\n\n        .time-slot {\n            padding: 10px;\n            border: 2px solid #667eea;\n            background: white;\n            color: #667eea;\n            border-radius: 6px;\n            cursor: pointer;\n            transition: all 0.3s;\n        }\n\n        .time-slot:hover:not(.disabled) {\n            background: #667eea;\n            color: white;\n        }\n\n        .time-slot.disabled {\n            border-color: #ccc;\n            color: #ccc;\n            cursor: not-allowed;\n        }\n\n        .time-slot.selected {\n            background: #667eea;\n            color: white;\n        }\n\n        .btn-primary {\n            padding: 12px 30px;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n            border: none;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 16px;\n            transition: transform 0.2s;\n        }\n\n        .btn-primary:hover:not(:disabled) {\n            transform: translateY(-2px);\n        }\n\n        .btn-primary:disabled {\n            opacity: 0.6;\n            cursor: not-allowed;\n        }\n\n        .no-data {\n            text-align: center;\n            color: #999;\n            padding: 40px;\n            font-size: 16px;\n        }\n    `]\n})], PatientDashboardComponent);\nexport { PatientDashboardComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}